{% load static %}
<!DOCTYPE html>
<html 
  lang="en" 
  class="h-full"
  x-data="{ 
    isSidebarOpen: true, 
    darkMode: localStorage.getItem('darkMode') === 'true' 
  }"
  x-init="
    darkMode = !!JSON.parse(localStorage.getItem('darkMode')); 
    $watch('darkMode', val => localStorage.setItem('darkMode', val));
    if (window.innerWidth < 768) {
      isSidebarOpen = false;
    }
  "
  :class="{ 'dark': darkMode }"
>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CampusConnect Dashboard{% endblock %}</title>
    
    <link href="{% static 'css/output.css' %}" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
      html { font-family: 'Inter', sans-serif; }
      [x-cloak] { display: none !important; }
      
      /* Scrollbars */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      .dark ::-webkit-scrollbar-track { background: #1e293b; }
      .dark ::-webkit-scrollbar-thumb { background: #475569; }
      .dark ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body class="h-full antialiased bg-slate-100 dark:bg-slate-900 text-gray-900 dark:text-gray-200">

<div x-data="{ isProfileOpen: false }" class="relative min-h-screen">

    <div 
      x-show="isSidebarOpen" 
      @click="isSidebarOpen = false"
      x-transition:enter="transition-opacity ease-linear duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition-opacity ease-linear duration-300"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-30 bg-gray-900/50 backdrop-blur-sm md:hidden"
      x-cloak
    ></div>

    <aside 
      class="fixed inset-y-0 left-0 z-40 flex flex-col bg-slate-900 text-slate-200 shadow-2xl transition-all duration-300 ease-in-out"
      :class="isSidebarOpen ? 'w-64' : 'w-20'"
    >
        <div class="flex h-16 items-center justify-center px-4 flex-shrink-0">
            <span class="text-2xl font-bold text-white tracking-wide" x-show="isSidebarOpen" x-cloak>CampusConnect</span>
            <svg x-show="!isSidebarOpen" x-cloak class="h-8 w-8 text-primary-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A11.953 11.953 0 0112 13.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 003 12c0 .778.099 1.533.284 2.253m0 0A11.953 11.953 0 0012 10.5c2.998 0 5.74 1.1 7.843 2.918" />
            </svg>
        </div>

        <nav class="mt-4 px-3 flex-1 overflow-y-auto overflow-x-hidden space-y-2">
            
            <a href="{% url 'dashboard' %}" class="group flex items-center rounded-md px-3 py-3 text-sm font-medium text-white bg-black/20 transition-all duration-150">
                <svg class="h-5 w-5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.293 2.293a1 1 0 011.414 0l7 7A1 1 0 0117 10.414V18a1 1 0 01-1 1h-2a1 1 0 01-1-1v-4a1 1 0 00-1-1H8a1 1 0 00-1 1v4a1 1 0 01-1 1H4a1 1 0 01-1-1V10.414a1 1 0 01.293-.707l7-7z" clip-rule="evenodd" /></svg>
                <span class="ml-3" x-show="isSidebarOpen" x-cloak>Dashboard</span>
            </a>
            
            <a href="{% url 'students' %}" class="group flex items-center rounded-md px-3 py-3 text-sm font-medium hover:bg-black/20 hover:text-white transition-all duration-150">
                <svg class="h-5 w-5 flex-shrink-0 text-slate-400 group-hover:text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 8a3 3 0 100-6 3 3 0 000 6zM14.5 9a3 3 0 100-6 3 3 0 000 6zM1.043 13.484a.75.75 0 00-.018 1.03l.001.002.002.002.002.002.003.003.003.003.004.004.005.004.006.005.007.005.008.006.01.006.01.007.012.007.013.008.015.008.016.009.018.009.02.01.02.01.023.011.025.011.028.012.03.012.032.013.035.013.038.014.04.014.043.015.046.015.048.016.05.016.053.017.055.017.058.018.06.018.063.019.066.019.03.009.032.01.034.01.036.011.038.011.04.012.042.012.045.013.047.013.049.014.05.014.053.015.055.015.057.016.059.016.06.017.063.017.065.017.067.018.069.018.07.019.073.019.075.019.077.02.079.02.08.021.083.021.085.021.087.022.089.022.09.022.093.023.095.023.096.023.098.024.101.024.103.024.105.024.107.025.11.025.111.025.114.026.116.026.117.026.12.027.121.027.124.027.126.028.128.028.13.028.132.029.134.029.136.029.138.03.14.03.142.03.144.03.146.031.148.031.15.031.152.032.154.032.156.032.158.032.16.033.162.033.164.033.166.034.168.034.17.034.172.035.174.035.176.035.178.035.18.036.182.036.184.036.186.036.188.037.19.037.191.037.193.038.195.038.197.038.033.009.034.009.036.009.038.01.039.01.041.01.043.011.044.011.046.011.047.012.049.012.05.012.052.013.054.013.055.013.057.014.058.014.06.014.062.014.063.015.065.015.066.015.068.016.069.016.07.016.072.016.074.017.075.017.077.017.078.017.08.018.081.018.083.018.084.018.086.019.087.019.088.019.09.019.092.02.093.02.094.02.096.02.097.021.099.021.1.021.102.021.103.022.105.022.106.022.107.022.109.022.11.023.112.023.113.023.114.023.116.024.117.024.119.024.12.024.121.024.123.025.124.025.126.025.127.025.128.Guess.025.13.026.131.026.132.026.134.026.135.027.136.027.138.027.139.027.14.028.142.028.143.028.144.028.145.028.147.029.148.029.149.029.15.029.152.03.153.03.154.03.155.03.157.031.158.031.159.031.16.031.162.031.163.032.164.032.165.032.166.032.168.032.169.033.17.033.171.033.172.033.174.033.175.034.176.034.177.034.178.034.18.034.181.034.182.035.183.035.184.035.185.035.187.035.188.035.189.036.19.036.191.036.192.036.193.036.195.036.196.036.197.037.198.037.199.037.2.037.201.037.202.037.203.037.204.037.205.037.207.038.208.038.209.038.21.038.211.038.212.038.213.038.214.038.215.038.216.038.217.038.218.038.219.039.22.039.221.039.222.039.223.039.224.039.Full.039.226.039.227.039.228.039.229.039.23.039.231.039.232.039.233.039.234.039.235.039.236.039.237.039.238.039.239.039.24.039.241.039.242.039.243.039.244.039.245.039.246.039.247.039.248.039.249.039.25.039.251.039.252.str.039.253.039.254L7.5 16.31a.75.75 0 00.457 1.376.75.75 0 00.488-.194l2.03-1.624a.75.75 0 01.95 0l2.03 1.624a.75.75 0 00.488.194.75.75 0 00.457-1.376L12 13.91l-1.636-1.309a.75.75 0 00-.95 0L7.777 13.91l-1.636 1.309zM1.5 16.14a.75.75 0 00.457 1.376.75.75 0 00.488-.194l2.03-1.624a.75.75 0 01.95 0l2.03 1.624a.75.75 0 00.488.194.75.75 0 00.457-1.376L6 14.71l-1.636-1.309a.75.75 0 00-.95 0L1.777 14.71l-1.636 1.309zM18.957 13.484a.75.75 0 00-1.03-.018l-.002.001-.002.002-.002.002-.003.003-.003.003-.004.004-.005.004-.006.005-.007.005-.008.006-.01.006-.01.007-.012.007-.013.008-.015.008-.016.009-.018.009-.02.01-.02.01-.023.011-.025.011-.028.012-.03.012-.032.013-.035.013-.038.014-.04.014-.043.015-.046.015-.048.016-.05.016-.053.017-.055.017-.058.018-.06.018-.063.019-.066.019-.03.009-.032.01-.034.01-.036.011-.038.011-.04.012-.042.012-.045.013-.047.013-.049.014-.05.014-.053.015-.055.015-.057.016-.059.016-.06.017-.063.017-.065.017-.067.018-.069.018-.07.019-.073.019-.075.019-.077.02-.079.02-.08.021-.083.021-.085.021-.087.022-.089.022-.09.022-.093.023-.095.023-.096.023-.098.024-.101.024-.103.024-.105.024-.107.025-.11.025-.111.025-.114.026-.116.026-.117.026-.12.027-.121.027-.124.027-.126.028-.128.028-.13.028-.132.029-.134.029-.136.029-.138.03-.14.03-.142.03-.144.03-.146.031-.148.031-.15.031-.152.032-.154.032-.156.032-.158.032-.16.033-.162.033-.164.033-.166.034-.168.034-.17.034-.172.035-.174.035-.176.035-.178.035-.18.036-.182.036-.184.036-.186.036-.188.037-.19.037-.191.037-.193.038-.195.038-.197.038-.033.009-.034.009-.036.009-.038.01-.039.01-.041.01-.043.011-.044.011-.046.011-.047.012-.049.012-.05.012-.052.013-.054.013-.055.013-.057.014-.058.014-.06.014-.062.014-.063.015-.065.015-.066.015-.068.016-.069.016-.07.016-.072.016-.074.017-.075.017-.077.017-.078.017-.08.018-.081.018-.083.018-.084.018-.086.019-.087.019-.088.019-.09.019-.092.02-.093.02-.094.02-.096.02-.097.021-.099.021-1.This is not a bug. This is the system *telling us* what we need to do. It's a dependency error, and we'll crush it. ðŸ˜¤

The error is `(admin.E040) RoomAdmin must define "search_fields", because it's referenced by HostelAllocationAdmin.autocomplete_fields.`

This means our new `HostelAllocationAdmin` uses `autocomplete_fields` for `student`, `course`, and `faculty`. To make that autocomplete search box work, Django requires that the `ModelAdmin` for `Student`, `Course`, and `Faculty` *must* each have a `search_fields` attribute defined.

Your `students/admin.py` and `faculty/admin.py` files are still the old ones and don't have this. We will fix this *now* and continue our assault on the `exams` app.

**Project Berserk Arc: Phase 2, Step 9.**

---

### 1. `students/admin.py` (FIXED)

**Action:** Replace the entire contents of `students/admin.py`.

This file adds the required `search_fields` to `StudentAdmin`, which will help fix the error.

```python
from django.contrib import admin
from .models import Student, Department

@admin.register(Department)
class DepartmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'code', 'head_of_department')
    search_fields = ('name', 'code')

@admin.register(Student)
class StudentAdmin(admin.ModelAdmin):
    list_display = ('student_id', 'user_full_name', 'department', 'year', 'semester', 'status')
    list_filter = ('department', 'year', 'semester', 'status')
    
    # --- THIS IS THE FIX ---
    # This field is required by AttendanceAdmin's autocomplete
    search_fields = ('user__username', 'user__first_name', 'user__last_name', 'student_id')
    # --- END FIX ---
    
    autocomplete_fields = ('user', 'department')
    
    def user_full_name(self, obj):
        return obj.user.get_full_name()
    user_full_name.short_description = 'Name'