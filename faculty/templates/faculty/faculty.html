{% extends "core/base.html" %}

{% block title %}Faculty Management{% endblock %}

{% block page_title %}Faculty Management{% endblock %}

{% block content %}

<div class="bg-card p-6 rounded-2xl shadow-lg border border-border mb-6 animate-fade-in-up">
  
  <form method="GET" action="{% url 'faculty' %}" class="mb-4 pb-4 border-b border-border django-filter-form">
    <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4 items-end">
      <div class="space-y-2 md:col-span-2">
        <label for="{{ filter_form.form.search.id_for_label }}" class="text-sm font-medium text-muted-foreground">{{ filter_form.form.search.label }}</label>
        {{ filter_form.form.search }}
      </div>
      <div class="space-y-2">
        <label for="{{ filter_form.form.department.id_for_label }}" class="text-sm font-medium text-muted-foreground">{{ filter_form.form.department.label }}</label>
        {{ filter_form.form.department }}
      </div>
      <div class="space-y-2">
        <label for="{{ filter_form.form.designation.id_for_label }}" class="text-sm font-medium text-muted-foreground">{{ filter_form.form.designation.label }}</label>
        {{ filter_form.form.designation }}
      </div>
      <div class="space-y-2">
        <label for="{{ filter_form.form.status.id_for_label }}" class="text-sm font-medium text-muted-foreground">{{ filter_form.form.status.label }}</label>
        {{ filter_form.form.status }}
      </div>
      
      <div class="flex gap-2">
        <button type="submit" class="btn-primary w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm">
          <i data-lucide="filter" class="w-4 h-4"></i>
          Filter
        </button>
        <a href="{% url 'faculty' %}" class="btn-secondary w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
        </a>
      </div>
    </div>
  </form>
  {% if user.role == 'admin' %}
  <div>
    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
      <div class="flex-1">
        <h4 class="text-sm font-medium text-foreground">Manage Faculty</h4>
        <p class="text-xs text-muted-foreground">Add a new faculty member to the system.</p>
      </div>
      <div class="flex gap-3">
        <a 
          href="{% url 'add_faculty' %}" 
          class="btn-primary flex items-center gap-2 px-4 py-2 rounded-lg text-sm"
        >
          <i data-lucide="plus" class="w-4 h-4"></i>
          Add Faculty
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<div class="bg-card rounded-2xl shadow-lg border border-border overflow-hidden animate-fade-in-up" style="animation-delay: 200ms;">
  <div class="overflow-x-auto">
    <table class="w-full min-w-max text-sm text-left">
      <thead class="bg-muted border-b border-border">
        <tr>
          <th class="p-4 font-semibold text-muted-foreground">Employee ID</th>
          <th class="p-4 font-semibold text-muted-foreground">Name</th>
          <th class="p-4 font-semibold text-muted-foreground">Department</th>
          <th class="p-4 font-semibold text-muted-foreground">Designation</th>
          <th class="p-4 font-semibold text-muted-foreground">Email</th>
          <th class="p-4 font-semibold text-muted-foreground">Phone</th>
          
          {% if user.role == 'admin' %}
          <th class_ ="p-4 font-semibold text-muted-foreground text-right">Actions</th>
          {% endif %}
        </tr>
      </thead>
      <tbody class="divide-y divide-border">
        {% for faculty in faculty_list %}
        <tr class="table-row-hover stagger-table-row">
          <td class="p-4 text-muted-foreground font-mono">{{ faculty.employee_id }}</td>
          <td class="p-4 font-medium text-foreground">
            {{ faculty.user.first_name }} {{ faculty.user.last_name }}
          </td>
          <td class="p-4 text-muted-foreground">{{ faculty.department.name|default:"N/A" }}</td>
          <td class="p-4 text-muted-foreground">{{ faculty.designation }}</td>
          <td class="p-4 text-muted-foreground">{{ faculty.user.email }}</td>
          <td class="p-4 text-muted-foreground">{{ faculty.phone|default:"N/A" }}</td>
          
          {% if user.role == 'admin' %}
          <td class="p-4 flex justify-end gap-2">
            <button class="p-2 rounded-lg text-muted-foreground transition-all hover:bg-muted hover:text-primary"><i data-lucide="eye" class="w-4 h-4"></i></button>
            <a href="{% url 'edit_faculty' faculty.id %}" class="p-2 rounded-lg text-muted-foreground transition-all hover:bg-muted hover:text-primary"><i data-lucide="edit" class="w-4 h-4"></i></a>
            
            <form method="POST" action="{% url 'delete_faculty' faculty.id %}">
              {% csrf_token %}
              <button type="submit" onclick="return confirm('Are you sure you want to delete this faculty member? This will also delete their user account.');" class="p-2 rounded-lg text-muted-foreground transition-all hover:bg-muted hover:text-destructive"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </form>
            
          </td>
          {% endif %}
          
        </tr>
        {% empty %}
        <tr class="table-row-hover">
          <td colspan="7" class="p-4 text-center text-muted-foreground">No faculty found matching your filters.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="p-4 border-t border-border flex items-center justify-between">
    <p class="text-sm text-muted-foreground">Showing <strong>{{ faculty_list|length }}</strong> results</p>
    <div class="flex gap-2">
      <button class="px-4 py-2 rounded-lg border border-input text-sm font-medium transition-all hover:bg-primary hover:text-primary-foreground hover:border-primary disabled:opacity-50 disabled:hover:bg-transparent disabled:hover:text-muted-foreground disabled:hover:border-input" disabled>Previous</button>
      <button class="px-4 py-2 rounded-lg border border-input text-sm font-medium transition-all hover:bg-primary hover:text-primary-foreground hover:border-primary disabled:opacity-50 disabled:hover:bg-transparent disabled:hover:text-muted-foreground disabled:hover:border-input">Next</button>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<style>
  /* Style all inputs/selects from the filter form */
  .django-filter-form select {
    @apply form-select w-full;
  }
  .django-filter-form input[type="text"] {
    @apply form-input w-full;
  }
</style>
{% endblock %}